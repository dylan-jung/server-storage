<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Details</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        .qr-container {
            background: white;
            padding: 1rem;
            border-radius: 1rem;
            display: inline-block;
            margin: 2rem 0;
        }
        
        .file-info {
            text-align: center;
            margin-bottom: 2rem;
        }

        .file-link {
            word-break: break-all;
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 500;
        }

        .file-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>File Details</h1>
            <p class="subtitle">Scan QR code or use the link below</p>
        </header>

        <main class="card" style="text-align: center;">
            <div id="file-content">
                <h2 class="section-title" style="justify-content: center; margin-bottom: 0.5rem;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <span id="filename-display">Loading...</span>
                </h2>

                <div id="qrcode" class="qr-container"></div>

                <div class="file-info">
                    <p style="color: #94a3b8; margin-bottom: 0.5rem;">Direct Link:</p>
                    <a id="file-link" href="#" class="file-link" target="_blank">Loading...</a>
                </div>

                <a href="/" class="btn btn-primary">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                    Back to Files
                </a>
            </div>
            <div id="error-message" style="display: none; color: #ef4444;">
                File not specified
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const filename = urlParams.get('file');
            // Handle encoded filename correctly
            const decodedFilename = filename ? decodeURIComponent(filename) : null;

            if (!decodedFilename) {
                document.getElementById('file-content').style.display = 'none';
                document.getElementById('error-message').style.display = 'block';
                return;
            }

            // Update UI
            document.getElementById('filename-display').textContent = decodedFilename;
            
            // Construct file URL
            // Assuming files are served from /data/ directory based on app.js configuration
            // app.use(express.static(path.join(__dirname, "public")));
            // DATA_DIR = public/data
            // So /data/filename is the path
            const fileUrl = `${window.location.origin}/data/${encodeURIComponent(decodedFilename)}`;
            
            const linkElement = document.getElementById('file-link');
            linkElement.href = fileUrl;
            linkElement.textContent = fileUrl;

            // Generate QR Code
            new QRCode(document.getElementById("qrcode"), {
                text: fileUrl,
                width: 200,
                height: 200,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        });
    </script>
</body>
</html>
